<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CargoLens | Zambia Logistics Platform</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- QR Scanner -->
    <script src="https://unpkg.com/html5-qrcode"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #3b82f6;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #94a3b8;
            --gradient: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --gradient-dark: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --sidebar-width: 280px;
            --header-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            transition: opacity 0.5s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Auth Page */
        .auth-container {
            min-height: 100vh;
            background: var(--gradient);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-container.hidden {
            display: none;
        }
        
        .auth-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 40px 30px;
            width: 100%;
            max-width: 420px;
            box-shadow: var(--shadow-lg);
        }
        
        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            font-family: 'Montserrat', sans-serif;
        }
        
        .auth-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .btn {
            padding: 14px 24px;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: none;
            font-size: 1rem;
            font-family: 'Montserrat', sans-serif;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .demo-accounts {
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: var(--radius);
        }
        
        .demo-accounts h4 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .demo-account {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 12px 15px;
            background: white;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .demo-account:hover {
            background: var(--primary);
            color: white;
            transform: translateX(5px);
        }
        
        /* Dashboard Layout */
        .dashboard-container {
            display: none;
            min-height: 100vh;
            position: relative;
        }
        
        .dashboard-container.active {
            display: flex;
            flex-direction: column;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--sidebar-width);
            background: white;
            box-shadow: 2px 0 20px rgba(0,0,0,0.08);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        
        @media (min-width: 1024px) {
            .sidebar {
                transform: translateX(0);
            }
        }
        
        .sidebar.active {
            transform: translateX(0);
        }
        
        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark);
            font-family: 'Montserrat', sans-serif;
        }
        
        .sidebar-nav {
            padding: 20px 0;
        }
        
        .nav-section {
            margin-bottom: 30px;
        }
        
        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 20px 10px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 20px;
            color: var(--secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            border-left: 4px solid transparent;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.95rem;
        }
        
        .nav-item:hover,
        .nav-item.active {
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.08) 0%, rgba(37, 99, 235, 0.04) 100%);
            color: var(--primary);
            border-left-color: var(--primary);
        }
        
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid #f1f5f9;
            margin-top: auto;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--dark);
            margin-bottom: 2px;
        }
        
        .user-role {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Header */
        .main-header {
            background: white;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 900;
        }
        
        @media (min-width: 1024px) {
            .main-header {
                margin-left: var(--sidebar-width);
                width: calc(100% - var(--sidebar-width));
            }
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .header-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark);
        }
        
        @media (min-width: 768px) {
            .header-title {
                font-size: 1.5rem;
            }
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .search-bar {
            position: relative;
            width: 300px;
            display: none;
        }
        
        @media (min-width: 768px) {
            .search-bar {
                display: block;
            }
        }
        
        .search-bar.active {
            display: block;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
        }
        
        .search-bar input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius);
            background: #f8fafc;
            font-size: 0.95rem;
        }
        
        .search-bar i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        .header-icons {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: none;
            font-size: 1.1rem;
        }
        
        .icon-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }
        
        /* Main Content */
        .main-content {
            padding: 20px;
            flex: 1;
            width: 100%;
        }
        
        @media (min-width: 1024px) {
            .main-content {
                margin-left: var(--sidebar-width);
                padding: 30px;
            }
        }
        
        /* Page Content */
        .page-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .page-content.active {
            display: block;
        }
        
        .page-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        @media (min-width: 768px) {
            .page-title {
                font-size: 2rem;
            }
        }
        
        .page-subtitle {
            font-size: 1rem;
            color: var(--gray);
            margin-bottom: 30px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 640px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-card-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            background: var(--gradient);
        }
        
        .stat-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .stat-card-trend {
            font-size: 0.9rem;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-card-trend.down {
            color: var(--danger);
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Tables */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--radius);
            background: white;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }
        
        th {
            background: #f8fafc;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            white-space: nowrap;
        }
        
        .status-delivered { background: #dcfce7; color: #166534; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-in-transit { background: #dbeafe; color: #1e40af; }
        .status-failed { background: #fee2e2; color: #991b1b; }
        .status-active { background: #dcfce7; color: #166534; }
        .status-offline { background: #f1f5f9; color: #64748b; }
        
        /* Map */
        .map-container {
            height: 400px;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }
        
        #map, #adminMap, #dispatcherMap, #driverMap {
            width: 100%;
            height: 100%;
        }
        
        /* Analytics Charts */
        .chart-container {
            height: 300px;
            margin-top: 20px;
            position: relative;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (min-width: 768px) {
            .quick-actions {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .action-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #f1f5f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            background: var(--gradient);
            color: white;
            border-color: transparent;
        }
        
        .action-card:hover .action-icon {
            color: white;
        }
        
        .action-icon {
            font-size: 2rem;
            color: var(--primary);
        }
        
        /* Delivery Card */
        .delivery-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }
        
        .delivery-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .delivery-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .close-btn:hover {
            background: #f1f5f9;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 16px 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 90%;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        .toast.warning { background: var(--warning); }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            border-top: 1px solid #f1f5f9;
        }
        
        @media (min-width: 1024px) {
            .bottom-nav {
                display: none;
            }
        }
        
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: var(--gray);
            font-size: 0.8rem;
            border: none;
            background: none;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--radius);
            transition: all 0.3s ease;
        }
        
        .bottom-nav-item.active {
            color: var(--primary);
            background: rgba(37, 99, 235, 0.08);
        }
        
        .bottom-nav-icon {
            font-size: 1.3rem;
        }
        
        /* Overlay */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            backdrop-filter: blur(4px);
        }
        
        @media (max-width: 1023px) {
            .sidebar-overlay.active {
                display: block;
            }
        }
        
        /* Menu Toggle */
        .menu-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            border-radius: var(--radius);
            transition: background 0.3s ease;
        }
        
        .menu-toggle:hover {
            background: #f1f5f9;
        }
        
        @media (min-width: 1024px) {
            .menu-toggle {
                display: none;
            }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #e2e8f0;
            opacity: 0.7;
        }
        
        /* Search Results */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 var(--radius) var(--radius);
            box-shadow: var(--shadow-lg);
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
        }
        
        .search-results.active {
            display: block;
        }
        
        .search-result-item {
            padding: 14px 20px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .search-result-item:hover {
            background: #f8fafc;
        }
        
        /* QR Scanner */
        .qr-scanner-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        #qr-reader {
            width: 100%;
            border-radius: var(--radius);
            overflow: hidden;
        }
        
        /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            padding: 40px 20px;
            margin-top: 60px;
        }
        
        @media (min-width: 768px) {
            .footer {
                padding: 60px 40px;
            }
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        @media (min-width: 768px) {
            .footer-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
        }
        
        .footer-copyright {
            text-align: center;
            font-size: 0.95rem;
            color: rgba(255,255,255,0.7);
        }
        
        .footer-copyright a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        
        .footer-copyright a:hover {
            color: var(--primary-light);
        }
        
        /* Driver Specific */
        .driver-header {
            background: var(--gradient);
            color: white;
            padding: 25px;
            border-radius: var(--radius);
            margin-bottom: 30px;
        }
        
        /* Responsive Utilities */
        .mobile-only {
            display: block;
        }
        
        @media (min-width: 1024px) {
            .mobile-only {
                display: none;
            }
        }
        
        .desktop-only {
            display: none;
        }
        
        @media (min-width: 1024px) {
            .desktop-only {
                display: block;
            }
        }
        
        /* Button Sizes */
        .btn-sm {
            padding: 10px 18px;
            font-size: 0.9rem;
        }
        
        .btn-lg {
            padding: 18px 30px;
            font-size: 1.1rem;
        }
        
        /* Zambian Theme */
        .zm-flag-colors {
            background: linear-gradient(135deg, #198a00 0%, #ef2d2d 50%, #000000 100%);
        }
        
        /* Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-shipping-fast"></i>
            <span>CargoLens</span>
        </div>
        <div class="spinner"></div>
        <p style="margin-top: 20px; font-size: 1rem;">Loading Zambia Logistics Platform...</p>
    </div>
    
    <!-- Auth Page -->
    <div class="auth-container" id="authPage">
        <div class="auth-card">
            <div class="auth-logo">
                <i class="fas fa-shipping-fast"></i>
                <span>CargoLens</span>
            </div>
            
            <h2 class="auth-title">Welcome to CargoLens</h2>
            
            <form id="authForm">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="authEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="authPassword" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In to Dashboard
                </button>
            </form>
            
            <div class="demo-accounts">
                <h4>Demo Accounts (Click to Use):</h4>
                <div class="demo-account" data-email="admin@cargolens.co.zm" data-password="admin123">
                    <span>Administrator</span>
                    <span>Full System Access</span>
                </div>
                <div class="demo-account" data-email="dispatch@cargolens.co.zm" data-password="dispatch123">
                    <span>Dispatch Manager</span>
                    <span>Package & Driver Management</span>
                </div>
                <div class="demo-account" data-email="driver@cargolens.co.zm" data-password="driver123">
                    <span>Delivery Driver</span>
                    <span>Delivery Operations</span>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 25px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                <p style="color: var(--gray); font-size: 0.9rem;">CargoLens Logistics Platform v2.0</p>
            </div>
        </div>
    </div>
    
    <!-- Admin Dashboard -->
    <div class="dashboard-container" id="adminDashboard">
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-shipping-fast"></i>
                    <span>CargoLens</span>
                </div>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <button class="nav-item active" data-page="admin-overview">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Overview</span>
                    </button>
                    <button class="nav-item" data-page="admin-analytics">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <button class="nav-item" data-page="admin-packages">
                        <i class="fas fa-boxes"></i>
                        <span>Packages</span>
                    </button>
                    <button class="nav-item" data-page="admin-drivers">
                        <i class="fas fa-truck"></i>
                        <span>Drivers</span>
                    </button>
                    <button class="nav-item" data-page="admin-routes">
                        <i class="fas fa-route"></i>
                        <span>Routes</span>
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Tracking</div>
                    <button class="nav-item" data-page="admin-tracking">
                        <i class="fas fa-map-marked-alt"></i>
                        <span>Live Tracking</span>
                    </button>
                    <button class="nav-item" data-page="admin-reports">
                        <i class="fas fa-file-alt"></i>
                        <span>Reports</span>
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <button class="nav-item" data-page="admin-settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                    <button class="nav-item" data-page="admin-users">
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                    </button>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar" id="adminAvatar">A</div>
                    <div class="user-info">
                        <div class="user-name" id="adminUserName">Administrator</div>
                        <div class="user-role">System Admin</div>
                    </div>
                    <button class="icon-btn" id="adminLogoutBtn" style="background: transparent; color: var(--dark);">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div style="flex: 1; overflow: hidden;">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="header-title" id="pageTitle">Dashboard Overview</h1>
                </div>
                
                <div class="header-actions">
                    <div class="search-bar" id="searchBar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search packages, drivers, locations...">
                        <div class="search-results" id="searchResults"></div>
                    </div>
                    
                    <div class="header-icons">
                        <button class="icon-btn mobile-only" id="searchToggle">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="icon-btn" id="notificationsBtn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                        <button class="icon-btn" id="adminAddBtn">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Main Content Area -->
            <div class="main-content">
                <!-- Overview Page -->
                <div class="page-content active" id="admin-overview">
                    <h1 class="page-title">Dashboard Overview</h1>
                    <div class="page-subtitle">Welcome to CargoLens Admin Dashboard. Monitor your logistics operations in real-time.</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Total Shipments</div>
                                <div class="stat-card-icon">
                                    <i class="fas fa-box"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">2,847</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>18% increase</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">This month</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Active Deliveries</div>
                                <div class="stat-card-icon" style="background: var(--success);">
                                    <i class="fas fa-shipping-fast"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">184</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>On track</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">Across Zambia</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Active Drivers</div>
                                <div class="stat-card-icon" style="background: var(--warning);">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">42</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>All available</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">On duty today</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Revenue</div>
                                <div class="stat-card-icon" style="background: var(--primary-dark);">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">ZK 2.4M</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>22% growth</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">This quarter</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Recent Shipments</h2>
                                <button class="btn btn-sm" onclick="navigateToPage('admin-packages')">View All</button>
                            </div>
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Tracking ID</th>
                                            <th>Destination</th>
                                            <th>Status</th>
                                            <th>Driver</th>
                                            <th>ETA</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentShipments">
                                        <!-- Filled by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Performance Metrics</h2>
                                <button class="btn btn-sm" onclick="refreshMetrics()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="chart-container">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h2 class="card-title">Quick Actions</h2>
                        </div>
                        <div class="quick-actions">
                            <button class="action-card" onclick="showModal('addPackageModal')">
                                <i class="action-icon fas fa-plus-circle"></i>
                                <span>New Shipment</span>
                            </button>
                            <button class="action-card" onclick="showModal('assignDriverModal')">
                                <i class="action-icon fas fa-user-check"></i>
                                <span>Assign Driver</span>
                            </button>
                            <button class="action-card" onclick="navigateToPage('admin-tracking')">
                                <i class="action-icon fas fa-map-marker-alt"></i>
                                <span>Live Tracking</span>
                            </button>
                            <button class="action-card" onclick="showModal('generateReportModal')">
                                <i class="action-icon fas fa-chart-bar"></i>
                                <span>Generate Report</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Page -->
                <div class="page-content" id="admin-analytics">
                    <h1 class="page-title">Business Analytics</h1>
                    <div class="page-subtitle">Comprehensive insights and performance metrics</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Delivery Success Rate</div>
                                <div class="stat-card-icon" style="background: var(--success);">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">96.7%</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>+2.3% this month</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Average Delivery Time</div>
                                <div class="stat-card-icon" style="background: var(--primary);">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">2.8 hrs</div>
                            <div class="stat-card-trend down">
                                <i class="fas fa-arrow-down"></i>
                                <span>-15 min improvement</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Customer Satisfaction</div>
                                <div class="stat-card-icon" style="background: var(--warning);">
                                    <i class="fas fa-star"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">4.8/5</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>+0.2 this quarter</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Fuel Efficiency</div>
                                <div class="stat-card-icon" style="background: var(--dark);">
                                    <i class="fas fa-gas-pump"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">8.4 km/L</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>Optimized routes</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Monthly Performance</h2>
                                <select class="form-control" style="width: auto; padding: 8px 16px;" onchange="updateAnalyticsChart()">
                                    <option>Last 6 months</option>
                                    <option>Last year</option>
                                    <option>Quarterly</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="monthlyAnalyticsChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Regional Distribution</h2>
                            </div>
                            <div class="chart-container">
                                <canvas id="regionalChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h2 class="card-title">Top Performing Drivers</h2>
                            <button class="btn btn-sm" onclick="navigateToPage('admin-drivers')">View All</button>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Driver</th>
                                        <th>Completed</th>
                                        <th>On-time Rate</th>
                                        <th>Rating</th>
                                        <th>Region</th>
                                    </tr>
                                </thead>
                                <tbody id="topDriversTable">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Packages Page -->
                <div class="page-content" id="admin-packages">
                    <h1 class="page-title">Shipment Management</h1>
                    <div class="page-subtitle">Manage all packages and shipments across Zambia</div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showModal('addPackageModal')">
                            <i class="fas fa-plus"></i> New Shipment
                        </button>
                        <button class="btn" onclick="exportToExcel()" style="background: white; border: 1px solid #e2e8f0;">
                            <i class="fas fa-file-excel"></i> Export
                        </button>
                        <button class="btn" onclick="showModal('bulkUploadModal')" style="background: white; border: 1px solid #e2e8f0;">
                            <i class="fas fa-upload"></i> Bulk Upload
                        </button>
                        <div style="flex: 1; min-width: 250px;">
                            <div class="search-bar" style="display: block; position: relative;">
                                <i class="fas fa-search"></i>
                                <input type="text" class="form-control" placeholder="Search shipments..." oninput="searchShipments(this.value)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">All Shipments</h2>
                            <div style="display: flex; gap: 10px;">
                                <select class="form-control" style="width: auto; padding: 8px 16px;" onchange="filterShipments(this.value)">
                                    <option value="all">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="in-transit">In Transit</option>
                                    <option value="delivered">Delivered</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tracking ID</th>
                                        <th>Recipient</th>
                                        <th>Destination</th>
                                        <th>Status</th>
                                        <th>Driver</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="allShipmentsTable">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Drivers Page -->
                <div class="page-content" id="admin-drivers">
                    <h1 class="page-title">Driver Management</h1>
                    <div class="page-subtitle">Manage drivers and their assignments across Zambia</div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Driver Locations</h2>
                                <button class="btn btn-sm" onclick="refreshDriverMap()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="map-container" style="height: 350px;">
                                <div id="adminMap"></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Driver Statistics</h2>
                            </div>
                            <div style="padding: 20px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--primary);">42</div>
                                        <div style="font-size: 0.9rem; color: var(--gray);">Total Drivers</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--success);">38</div>
                                        <div style="font-size: 0.9rem; color: var(--gray);">Active Now</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--warning);">4.8</div>
                                        <div style="font-size: 0.9rem; color: var(--gray);">Avg Rating</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--dark);">92%</div>
                                        <div style="font-size: 0.9rem; color: var(--gray);">On-time Rate</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="padding: 20px; border-top: 1px solid #f1f5f9;">
                                <h3 style="margin-bottom: 15px;">Quick Actions</h3>
                                <div style="display: grid; gap: 12px;">
                                    <button class="btn" onclick="showModal('addDriverModal')" style="justify-content: flex-start;">
                                        <i class="fas fa-user-plus"></i> Add New Driver
                                    </button>
                                    <button class="btn" onclick="showModal('assignShiftModal')" style="justify-content: flex-start;">
                                        <i class="fas fa-calendar-alt"></i> Assign Shifts
                                    </button>
                                    <button class="btn" onclick="showModal('sendBroadcastModal')" style="justify-content: flex-start;">
                                        <i class="fas fa-bullhorn"></i> Send Broadcast
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h2 class="card-title">All Drivers</h2>
                            <button class="btn btn-sm" onclick="exportDriverData()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Driver</th>
                                        <th>Contact</th>
                                        <th>Vehicle</th>
                                        <th>Status</th>
                                        <th>Location</th>
                                        <th>Assigned</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="driversTable">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Routes Page -->
                <div class="page-content" id="admin-routes">
                    <h1 class="page-title">Route Planning</h1>
                    <div class="page-subtitle">Optimize delivery routes across Zambia</div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Route Map</h2>
                                <button class="btn btn-sm" onclick="optimizeRoutes()">
                                    <i class="fas fa-magic"></i> Optimize
                                </button>
                            </div>
                            <div class="map-container" style="height: 400px;">
                                <div id="routeMap"></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Route Statistics</h2>
                            </div>
                            <div style="padding: 20px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--primary);">156</div>
                                        <div style="font-size: 0.9rem; color: var(--gray);">Active Routes</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--success);">18%</div>
                                        <div style="font-size: 0.9rem; color: var(--gray);">Fuel Savings</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--warning);">42 min</div>
                                        <div style="font-size: 0.9rem; color: var(--gray);">Avg Time Saved</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--dark);">ZK 24K</div>
                                        <div style="font-size: 0.9rem; color: var(--gray);">Cost Reduction</div>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary" style="width: 100%;" onclick="createNewRoute()">
                                    <i class="fas fa-plus-circle"></i> Create New Route
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h2 class="card-title">Route Schedule</h2>
                            <button class="btn btn-sm" onclick="showModal('scheduleModal')">
                                <i class="fas fa-calendar-plus"></i> Add Schedule
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Route ID</th>
                                        <th>Start Point</th>
                                        <th>End Point</th>
                                        <th>Driver</th>
                                        <th>Schedule</th>
                                        <th>Stops</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="routesTable">
                                    <tr>
                                        <td>RT-001</td>
                                        <td>Lusaka DC</td>
                                        <td>Kabwe Center</td>
                                        <td>Mike Johnson</td>
                                        <td>Daily, 08:00</td>
                                        <td>5</td>
                                        <td>
                                            <button class="btn btn-sm" onclick="viewRoute('RT-001')">View</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Live Tracking Page -->
                <div class="page-content" id="admin-tracking">
                    <h1 class="page-title">Live Tracking</h1>
                    <div class="page-subtitle">Real-time tracking of all shipments and drivers across Zambia</div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Zambia Operations Map</h2>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-sm" onclick="zoomToLusaka()">
                                    <i class="fas fa-search-location"></i> Lusaka
                                </button>
                                <button class="btn btn-sm" onclick="zoomToNdola()">
                                    <i class="fas fa-search-location"></i> Ndola
                                </button>
                                <button class="btn btn-sm" onclick="zoomToKitwe()">
                                    <i class="fas fa-search-location"></i> Kitwe
                                </button>
                            </div>
                        </div>
                        <div class="map-container" style="height: 500px;">
                            <div id="adminTrackingMap"></div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid" style="margin-top: 30px;">
                        <div class="card">
                            <h2 class="card-title">Active Shipments</h2>
                            <div id="activeShipmentsList" style="max-height: 400px; overflow-y: auto;">
                                <!-- Filled by JS -->
                            </div>
                        </div>
                        
                        <div class="card">
                            <h2 class="card-title">Tracking Controls</h2>
                            <div style="padding: 20px;">
                                <div class="form-group">
                                    <label class="form-label">Track Shipment</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="text" class="form-control" id="trackShipmentInput" placeholder="Enter tracking ID">
                                        <button class="btn btn-primary" onclick="trackShipment()">Track</button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Select Driver</label>
                                    <select class="form-control" id="trackDriverSelect" onchange="focusOnDriver(this.value)">
                                        <option value="">Select driver to track</option>
                                    </select>
                                </div>
                                
                                <div style="margin-top: 25px;">
                                    <h3 style="margin-bottom: 15px;">Live Updates</h3>
                                    <div id="liveUpdates">
                                        <!-- Filled by JS -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Page -->
                <div class="page-content" id="admin-reports">
                    <h1 class="page-title">Reports & Analytics</h1>
                    <div class="page-subtitle">Generate comprehensive logistics reports</div>
                    
                    <div class="quick-actions" style="margin-bottom: 30px;">
                        <button class="action-card" onclick="generateReport('daily')">
                            <i class="action-icon fas fa-file-alt"></i>
                            <span>Daily Report</span>
                        </button>
                        <button class="action-card" onclick="generateReport('weekly')">
                            <i class="action-icon fas fa-chart-bar"></i>
                            <span>Weekly Report</span>
                        </button>
                        <button class="action-card" onclick="generateReport('monthly')">
                            <i class="action-icon fas fa-chart-pie"></i>
                            <span>Monthly Report</span>
                        </button>
                        <button class="action-card" onclick="generateReport('custom')">
                            <i class="action-icon fas fa-cog"></i>
                            <span>Custom Report</span>
                        </button>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Report Templates</h2>
                            </div>
                            <div style="padding: 20px;">
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <button class="btn" onclick="useTemplate('performance')" style="justify-content: flex-start;">
                                        <i class="fas fa-chart-line"></i> Performance Report
                                    </button>
                                    <button class="btn" onclick="useTemplate('financial')" style="justify-content: flex-start;">
                                        <i class="fas fa-money-bill-wave"></i> Financial Report
                                    </button>
                                    <button class="btn" onclick="useTemplate('driver')" style="justify-content: flex-start;">
                                        <i class="fas fa-truck"></i> Driver Performance
                                    </button>
                                    <button class="btn" onclick="useTemplate('inventory')" style="justify-content: flex-start;">
                                        <i class="fas fa-boxes"></i> Inventory Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Recent Reports</h2>
                                <button class="btn btn-sm" onclick="refreshReports()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Report ID</th>
                                            <th>Type</th>
                                            <th>Generated</th>
                                            <th>Size</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportsTable">
                                        <tr>
                                            <td>RPT-2024-001</td>
                                            <td>Monthly Performance</td>
                                            <td>2024-01-15</td>
                                            <td>2.4 MB</td>
                                            <td>
                                                <button class="btn btn-sm" onclick="downloadReport('RPT-2024-001')">Download</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Page -->
                <div class="page-content" id="admin-settings">
                    <h1 class="page-title">System Settings</h1>
                    <div class="page-subtitle">Configure platform settings and preferences</div>
                    
                    <div class="card">
                        <div style="padding: 30px;">
                            <div style="display: flex; flex-direction: column; gap: 25px;">
                                <div class="form-group">
                                    <h3 style="margin-bottom: 15px;">General Settings</h3>
                                    <div style="display: grid; gap: 20px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span>Enable Email Notifications</span>
                                            <label class="switch">
                                                <input type="checkbox" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span>Enable SMS Alerts</span>
                                            <label class="switch">
                                                <input type="checkbox" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span>Auto-optimize Routes</span>
                                            <label class="switch">
                                                <input type="checkbox">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <h3 style="margin-bottom: 15px;">Business Information</h3>
                                    <div style="display: grid; gap: 15px;">
                                        <input type="text" class="form-control" placeholder="Company Name" value="CargoLens Logistics">
                                        <input type="text" class="form-control" placeholder="Contact Email" value="contact@cargolens.co.zm">
                                        <input type="text" class="form-control" placeholder="Phone Number" value="+260 211 123 456">
                                        <input type="text" class="form-control" placeholder="Address" value="Lusaka, Zambia">
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary" onclick="saveSettings()">
                                    <i class="fas fa-save"></i> Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Users Page -->
                <div class="page-content" id="admin-users">
                    <h1 class="page-title">User Management</h1>
                    <div class="page-subtitle">Manage system users and permissions</div>
                    
                    <div style="margin-bottom: 25px;">
                        <button class="btn btn-primary" onclick="showModal('addUserModal')">
                            <i class="fas fa-user-plus"></i> Add New User
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Last Active</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable">
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div class="user-avatar" style="width: 36px; height: 36px;">A</div>
                                                <div>
                                                    <div style="font-weight: 600;">Administrator</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>admin@cargolens.co.zm</td>
                                        <td><span class="status-badge status-active">Admin</span></td>
                                        <td><span class="status-badge status-active">Active</span></td>
                                        <td>Today, 14:30</td>
                                        <td>
                                            <button class="btn btn-sm" onclick="editUser(1)">Edit</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation for Mobile -->
        <div class="bottom-nav">
            <button class="bottom-nav-item active" onclick="navigateToPage('admin-overview')">
                <i class="bottom-nav-icon fas fa-home"></i>
                <span>Home</span>
            </button>
            <button class="bottom-nav-item" onclick="navigateToPage('admin-packages')">
                <i class="bottom-nav-icon fas fa-box"></i>
                <span>Shipments</span>
            </button>
            <button class="bottom-nav-item" onclick="navigateToPage('admin-tracking')">
                <i class="bottom-nav-icon fas fa-map"></i>
                <span>Tracking</span>
            </button>
            <button class="bottom-nav-item" onclick="navigateToPage('admin-analytics')">
                <i class="bottom-nav-icon fas fa-chart-line"></i>
                <span>Analytics</span>
            </button>
        </div>
    </div>
    
    <!-- Dispatcher Dashboard -->
    <div class="dashboard-container" id="dispatcherDashboard">
        <div class="sidebar-overlay" id="dispatcherSidebarOverlay"></div>
        
        <!-- Sidebar -->
        <div class="sidebar" id="dispatcherSidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-shipping-fast"></i>
                    <span>CargoLens</span>
                </div>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <button class="nav-item active" data-page="dispatcher-overview">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Overview</span>
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <button class="nav-item" data-page="dispatcher-packages">
                        <i class="fas fa-boxes"></i>
                        <span>Packages</span>
                    </button>
                    <button class="nav-item" data-page="dispatcher-drivers">
                        <i class="fas fa-truck"></i>
                        <span>Drivers</span>
                    </button>
                    <button class="nav-item" data-page="dispatcher-assignments">
                        <i class="fas fa-tasks"></i>
                        <span>Assignments</span>
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Tracking</div>
                    <button class="nav-item" data-page="dispatcher-tracking">
                        <i class="fas fa-map-marked-alt"></i>
                        <span>Live Tracking</span>
                    </button>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar" id="dispatcherAvatar">D</div>
                    <div class="user-info">
                        <div class="user-name" id="dispatcherUserName">Dispatch Manager</div>
                        <div class="user-role">Dispatcher</div>
                    </div>
                    <button class="icon-btn" id="dispatcherLogoutBtn" style="background: transparent; color: var(--dark);">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div style="flex: 1; overflow: hidden;">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="menu-toggle" id="dispatcherMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="header-title" id="dispatcherPageTitle">Dispatch Overview</h1>
                </div>
                
                <div class="header-actions">
                    <div class="header-icons">
                        <button class="icon-btn" id="dispatcherAddBtn">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Main Content Area -->
            <div class="main-content">
                <!-- Overview Page -->
                <div class="page-content active" id="dispatcher-overview">
                    <h1 class="page-title">Dispatch Dashboard</h1>
                    <div class="page-subtitle">Manage packages and driver assignments efficiently</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Today's Deliveries</div>
                                <div class="stat-card-icon" style="background: var(--primary);">
                                    <i class="fas fa-box"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">156</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>24 pending</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">Need assignment</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Available Drivers</div>
                                <div class="stat-card-icon" style="background: var(--success);">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">18</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-check-circle"></i>
                                <span>Ready for work</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">On duty today</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>Urgent Shipments</div>
                                <div class="stat-card-icon" style="background: var(--warning);">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">12</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-clock"></i>
                                <span>Priority handling</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">Need immediate dispatch</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>On-time Rate</div>
                                <div class="stat-card-icon" style="background: var(--dark);">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <div class="stat-card-value">94%</div>
                            <div class="stat-card-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>+3% this week</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">Performance target</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Pending Assignments</h2>
                                <button class="btn btn-sm" onclick="showModal('quickAssignModal')">
                                    <i class="fas fa-bolt"></i> Quick Assign
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Shipment ID</th>
                                            <th>Destination</th>
                                            <th>Priority</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pendingAssignments">
                                        <!-- Filled by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Driver Availability</h2>
                                <button class="btn btn-sm" onclick="refreshDriverStatus()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div id="driverAvailability" style="max-height: 300px; overflow-y: auto;">
                                <!-- Filled by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h2 class="card-title">Quick Actions</h2>
                        </div>
                        <div class="quick-actions">
                            <button class="action-card" onclick="showModal('assignShipmentModal')">
                                <i class="action-icon fas fa-tasks"></i>
                                <span>Assign Shipment</span>
                            </button>
                            <button class="action-card" onclick="navigateToPage('dispatcher-tracking')">
                                <i class="action-icon fas fa-map-marker-alt"></i>
                                <span>Live Tracking</span>
                            </button>
                            <button class="action-card" onclick="showModal('broadcastModal')">
                                <i class="action-icon fas fa-bullhorn"></i>
                                <span>Broadcast Message</span>
                            </button>
                            <button class="action-card" onclick="showModal('generateDispatchReport')">
                                <i class="action-icon fas fa-file-alt"></i>
                                <span>Daily Report</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Packages Page -->
                <div class="page-content" id="dispatcher-packages">
                    <h1 class="page-title">Shipment Management</h1>
                    <div class="page-subtitle">Manage and assign packages to drivers</div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showModal('dispatcherAddPackageModal')">
                            <i class="fas fa-plus"></i> Add Shipment
                        </button>
                        <button class="btn" onclick="showModal('bulkAssignModal')" style="background: white; border: 1px solid #e2e8f0;">
                            <i class="fas fa-users"></i> Bulk Assign
                        </button>
                        <div style="flex: 1; min-width: 250px;">
                            <div class="search-bar" style="display: block; position: relative;">
                                <i class="fas fa-search"></i>
                                <input type="text" class="form-control" placeholder="Search shipments..." oninput="searchDispatcherShipments(this.value)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">All Shipments</h2>
                            <select class="form-control" style="width: auto; padding: 8px 16px;" onchange="filterDispatcherShipments(this.value)">
                                <option value="all">All Status</option>
                                <option value="unassigned">Unassigned</option>
                                <option value="assigned">Assigned</option>
                                <option value="in-transit">In Transit</option>
                            </select>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tracking ID</th>
                                        <th>Recipient</th>
                                        <th>Destination</th>
                                        <th>Status</th>
                                        <th>Driver</th>
                                        <th>Priority</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="dispatcherShipmentsTable">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Drivers Page -->
                <div class="page-content" id="dispatcher-drivers">
                    <h1 class="page-title">Driver Management</h1>
                    <div class="page-subtitle">Monitor and communicate with drivers</div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Driver Locations</h2>
                                <button class="btn btn-sm" onclick="refreshDispatcherMap()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="map-container" style="height: 350px;">
                                <div id="dispatcherMap"></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Driver Status</h2>
                            </div>
                            <div id="driverStatusList" style="max-height: 300px; overflow-y: auto; padding: 15px;">
                                <!-- Filled by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h2 class="card-title">Driver Communications</h2>
                            <button class="btn btn-sm" onclick="showModal('messageAllModal')">
                                <i class="fas fa-comments"></i> Message All
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Driver</th>
                                        <th>Status</th>
                                        <th>Current Task</th>
                                        <th>Last Update</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="dispatcherDriversTable">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Assignments Page -->
                <div class="page-content" id="dispatcher-assignments">
                    <h1 class="page-title">Assignment Management</h1>
                    <div class="page-subtitle">Create and manage driver assignments</div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <h2 class="card-title">Create New Assignment</h2>
                            <div style="padding: 20px;">
                                <div class="form-group">
                                    <label class="form-label">Select Driver</label>
                                    <select class="form-control" id="assignDriverSelect">
                                        <option value="">Select driver</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Select Shipments</label>
                                    <div id="availableShipments" style="max-height: 200px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: var(--radius); padding: 10px;">
                                        <!-- Filled by JS -->
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary" style="width: 100%;" onclick="createAssignment()">
                                    <i class="fas fa-check-circle"></i> Create Assignment
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h2 class="card-title">Active Assignments</h2>
                            <div id="activeAssignments" style="max-height: 400px; overflow-y: auto; padding: 15px;">
                                <!-- Filled by JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tracking Page -->
                <div class="page-content" id="dispatcher-tracking">
                    <h1 class="page-title">Live Tracking</h1>
                    <div class="page-subtitle">Monitor shipments and drivers in real-time</div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Operations Map</h2>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-sm" onclick="dispatcherZoomToLusaka()">
                                    <i class="fas fa-search-location"></i> Lusaka
                                </button>
                                <button class="btn btn-sm" onclick="showAllDrivers()">
                                    <i class="fas fa-users"></i> Show All Drivers
                                </button>
                            </div>
                        </div>
                        <div class="map-container" style="height: 500px;">
                            <div id="dispatcherTrackingMap"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation for Mobile -->
        <div class="bottom-nav">
            <button class="bottom-nav-item active" onclick="navigateToPage('dispatcher-overview')">
                <i class="bottom-nav-icon fas fa-home"></i>
                <span>Home</span>
            </button>
            <button class="bottom-nav-item" onclick="navigateToPage('dispatcher-packages')">
                <i class="bottom-nav-icon fas fa-box"></i>
                <span>Shipments</span>
            </button>
            <button class="bottom-nav-item" onclick="navigateToPage('dispatcher-drivers')">
                <i class="bottom-nav-icon fas fa-truck"></i>
                <span>Drivers</span>
            </button>
            <button class="bottom-nav-item" onclick="navigateToPage('dispatcher-tracking')">
                <i class="bottom-nav-icon fas fa-map"></i>
                <span>Tracking</span>
            </button>
        </div>
    </div>
    
    <!-- Driver Dashboard -->
    <div class="dashboard-container" id="driverDashboard">
        <div class="driver-header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                <div>
                    <h1 style="font-size: 1.8rem; margin-bottom: 10px;">Driver Dashboard</h1>
                    <p>Track your deliveries and manage your schedule</p>
                </div>
                <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h2 class="card-title">Today's Deliveries</h2>
                    <div id="driverDeliveries" style="max-height: 400px; overflow-y: auto;">
                        <!-- Filled by JS -->
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">My Location</h2>
                    <div class="map-container" style="height: 300px;">
                        <div id="driverMap"></div>
                    </div>
                    <div style="padding: 20px;">
                        <div class="form-group">
                            <label class="form-label">Update Status</label>
                            <select class="form-control" id="driverStatusSelect" onchange="updateDriverStatus(this.value)">
                                <option value="available">Available</option>
                                <option value="on-delivery">On Delivery</option>
                                <option value="break">On Break</option>
                                <option value="off-duty">Off Duty</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 30px;">
                <h2 class="card-title">Quick Actions</h2>
                <div class="quick-actions">
                    <button class="action-card" onclick="scanQRCode()">
                        <i class="action-icon fas fa-qrcode"></i>
                        <span>Scan QR</span>
                    </button>
                    <button class="action-card" onclick="startDelivery()">
                        <i class="action-icon fas fa-play-circle"></i>
                        <span>Start Delivery</span>
                    </button>
                    <button class="action-card" onclick="reportIssue()">
                        <i class="action-icon fas fa-exclamation-triangle"></i>
                        <span>Report Issue</span>
                    </button>
                    <button class="action-card" onclick="viewSchedule()">
                        <i class="action-icon fas fa-calendar-alt"></i>
                        <span>My Schedule</span>
                    </button>
                </div>
            </div>
            
            <div class="card" style="margin-top: 30px;">
                <h2 class="card-title">Recent Activity</h2>
                <div id="driverActivity" style="padding: 20px;">
                    <!-- Filled by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="addPackageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Shipment</h2>
                <button class="close-btn" onclick="hideModal('addPackageModal')">&times;</button>
            </div>
            
            <form id="addPackageForm">
                <div class="form-group">
                    <label class="form-label">Recipient Name</label>
                    <input type="text" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Destination City</label>
                    <select class="form-control" required>
                        <option value="">Select city</option>
                        <option value="lusaka">Lusaka</option>
                        <option value="ndola">Ndola</option>
                        <option value="kitwe">Kitwe</option>
                        <option value="livingstone">Livingstone</option>
                        <option value="kabwe">Kabwe</option>
                        <option value="chipata">Chipata</option>
                        <option value="solwezi">Solwezi</option>
                        <option value="mongu">Mongu</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Delivery Address</label>
                    <textarea class="form-control" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Package Details</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 0.85rem; color: var(--gray);">Weight (kg)</label>
                            <input type="number" class="form-control" placeholder="0.0" step="0.1">
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; color: var(--gray);">Dimensions (cm)</label>
                            <input type="text" class="form-control" placeholder="L x W x H">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select class="form-control" required>
                        <option value="standard">Standard</option>
                        <option value="express">Express (+15%)</option>
                        <option value="urgent">Urgent (+30%)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Special Instructions</label>
                    <textarea class="form-control" rows="2" placeholder="Any special handling requirements..."></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-save"></i> Create Shipment
                </button>
            </form>
        </div>
    </div>
    
    <!-- Add Driver Modal -->
    <div class="modal" id="addDriverModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Driver</h2>
                <button class="close-btn" onclick="hideModal('addDriverModal')">&times;</button>
            </div>
            
            <form id="addDriverForm">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Vehicle Information</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 0.85rem; color: var(--gray);">Make & Model</label>
                            <input type="text" class="form-control" placeholder="Toyota Hilux">
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; color: var(--gray);">License Plate</label>
                            <input type="text" class="form-control" placeholder="KAB 1234">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Assigned City</label>
                    <select class="form-control" required>
                        <option value="">Select city</option>
                        <option value="lusaka">Lusaka</option>
                        <option value="ndola">Ndola</option>
                        <option value="kitwe">Kitwe</option>
                        <option value="livingstone">Livingstone</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> Add Driver
                </button>
            </form>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast" id="toast"></div>

    <!-- Footer -->
    <footer class="footer" id="mainFooter" style="display: none;">
        <div class="footer-content">
            <div class="footer-logo">
                <i class="fas fa-shipping-fast"></i>
                <span>CargoLens Logistics</span>
            </div>
            
            <div class="footer-copyright">
                <p>&copy; 2024 CargoLens Logistics Platform. All rights reserved. Developed by <a href="#" style="color: #3b82f6;">GeeTech</a></p>
                <p style="margin-top: 8px; font-size: 0.9rem;">Lusaka, Zambia | contact@cargolens.co.zm | +260 211 123 456</p>
            </div>
        </div>
    </footer>

    <!-- Firebase Integration -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, setDoc, getDoc, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBtGrZU2HRXUsZaEWNFs3-lXgyWMezzzOg",
            authDomain: "cargolens-fcd66.firebaseapp.com",
            projectId: "cargolens-fcd66",
            storageBucket: "cargolens-fcd66.firebasestorage.app",
            messagingSenderId: "981220438640",
            appId: "1:981220438640:web:236dc1784e9017f2463ab5",
            measurementId: "G-4C95FEXHPX"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebase = {
            app,
            auth,
            db,
            analytics,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            getDocs,
            addDoc,
            collection,
            updateDoc,
            deleteDoc,
            doc,
            setDoc,
            getDoc,
            query,
            where,
            orderBy,
            limit
        };
        
        console.log("Firebase initialized successfully");
    </script>

    <script>
        // Application State
        let currentUser = null;
        let currentRole = null;
        let currentPage = 'admin-overview';
        let maps = {};
        let qrScanner = null;
        
        // Zambian Cities Coordinates
        const zambiaCities = {
            lusaka: { lat: -15.4167, lng: 28.2833, name: 'Lusaka' },
            ndola: { lat: -12.9667, lng: 28.6333, name: 'Ndola' },
            kitwe: { lat: -12.8167, lng: 28.2000, name: 'Kitwe' },
            livingstone: { lat: -17.8417, lng: 25.8542, name: 'Livingstone' },
            kabwe: { lat: -14.4333, lng: 28.4500, name: 'Kabwe' },
            chipata: { lat: -13.6333, lng: 32.6500, name: 'Chipata' },
            solwezi: { lat: -12.1833, lng: 26.4000, name: 'Solwezi' },
            mongu: { lat: -15.2775, lng: 23.1358, name: 'Mongu' },
            kasama: { lat: -10.2167, lng: 31.1833, name: 'Kasama' },
            mazabuka: { lat: -15.8569, lng: 27.7481, name: 'Mazabuka' }
        };
        
        // Sample Data
        const sampleData = {
            shipments: [
                { id: 'CL-2024-001', recipient: 'Chanda Bwalya', city: 'Lusaka', address: '123 Cairo Road', status: 'in-transit', driver: 'Mike Johnson', created: '2024-01-15', eta: '2 hours', weight: '5kg', priority: 'standard' },
                { id: 'CL-2024-002', recipient: 'Mwila Phiri', city: 'Ndola', address: '456 Broadway', status: 'pending', driver: null, created: '2024-01-16', eta: 'Tomorrow', weight: '12kg', priority: 'express' },
                { id: 'CL-2024-003', recipient: 'Bwalya Lungu', city: 'Kitwe', address: '789 Freedom Way', status: 'delivered', driver: 'Emily Davis', created: '2024-01-14', eta: 'Delivered', weight: '8kg', priority: 'standard' },
                { id: 'CL-2024-004', recipient: 'John Mulenga', city: 'Livingstone', address: '321 Mosi Road', status: 'in-transit', driver: 'Mike Johnson', created: '2024-01-17', eta: '5 hours', weight: '15kg', priority: 'urgent' },
                { id: 'CL-2024-005', recipient: 'Sarah Kunda', city: 'Kabwe', address: '654 Independence Ave', status: 'pending', driver: null, created: '2024-01-17', eta: 'Tomorrow', weight: '3kg', priority: 'standard' }
            ],
            drivers: [
                { id: 'DRV-001', name: 'Mike Johnson', phone: '+260 966 123 456', vehicle: 'Toyota Hilux KAB 1234', status: 'active', city: 'Lusaka', rating: 4.8, deliveries: 245, currentStatus: 'available' },
                { id: 'DRV-002', name: 'Emily Davis', phone: '+260 977 654 321', vehicle: 'Ford Transit ND 5678', status: 'active', city: 'Ndola', rating: 4.9, deliveries: 198, currentStatus: 'on-delivery' },
                { id: 'DRV-003', name: 'James Banda', phone: '+260 955 789 123', vehicle: 'Nissan Van LW 9012', status: 'offline', city: 'Livingstone', rating: 4.6, deliveries: 167, currentStatus: 'off-duty' },
                { id: 'DRV-004', name: 'Sarah Mwansa', phone: '+260 978 321 654', vehicle: 'Toyota Hiace CB 3456', status: 'active', city: 'Kabwe', rating: 4.7, deliveries: 189, currentStatus: 'available' }
            ],
            dispatcherShipments: [
                { id: 'CL-2024-006', recipient: 'David Phiri', city: 'Lusaka', status: 'unassigned', priority: 'urgent', created: '2024-01-18' },
                { id: 'CL-2024-007', recipient: 'Mary Banda', city: 'Ndola', status: 'unassigned', priority: 'express', created: '2024-01-18' },
                { id: 'CL-2024-008', recipient: 'Peter Lungu', city: 'Kitwe', status: 'assigned', driver: 'Mike Johnson', priority: 'standard', created: '2024-01-17' }
            ],
            driverDeliveries: [
                { id: 'CL-2024-001', recipient: 'Chanda Bwalya', address: '123 Cairo Road, Lusaka', status: 'in-transit', eta: '2 hours', progress: 60 },
                { id: 'CL-2024-004', recipient: 'John Mulenga', address: '321 Mosi Road, Livingstone', status: 'in-transit', eta: '5 hours', progress: 30 },
                { id: 'CL-2024-009', recipient: 'Anna Mwansa', address: '789 Kasama Street', status: 'pending', eta: 'Tomorrow', progress: 0 }
            ]
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CargoLens Zambia Platform Loading...');
            
            // Simulate loading
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                setupEventListeners();
                checkAuthState();
            }, 1500);
            
            // Setup demo accounts
            document.querySelectorAll('.demo-account').forEach(account => {
                account.addEventListener('click', function() {
                    const email = this.dataset.email;
                    const password = this.dataset.password;
                    document.getElementById('authEmail').value = email;
                    document.getElementById('authPassword').value = password;
                    showToast('Demo credentials loaded', 'success');
                });
            });
        });

        function setupEventListeners() {
            // Auth form
            document.getElementById('authForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleAuth();
            });

            // Logout buttons
            document.getElementById('adminLogoutBtn')?.addEventListener('click', logout);
            document.getElementById('dispatcherLogoutBtn')?.addEventListener('click', logout);

            // Menu toggle
            document.getElementById('menuToggle')?.addEventListener('click', function() {
                toggleSidebar('sidebar', 'sidebarOverlay');
            });

            document.getElementById('dispatcherMenuToggle')?.addEventListener('click', function() {
                toggleSidebar('dispatcherSidebar', 'dispatcherSidebarOverlay');
            });

            // Search toggle for mobile
            document.getElementById('searchToggle')?.addEventListener('click', function() {
                const searchBar = document.getElementById('searchBar');
                searchBar.classList.toggle('active');
                if (searchBar.classList.contains('active')) {
                    document.getElementById('searchInput').focus();
                }
            });

            // Search functionality
            document.getElementById('searchInput')?.addEventListener('input', function(e) {
                performSearch(e.target.value);
            });

            // Sidebar overlays
            document.getElementById('sidebarOverlay')?.addEventListener('click', function() {
                toggleSidebar('sidebar', 'sidebarOverlay');
            });

            document.getElementById('dispatcherSidebarOverlay')?.addEventListener('click', function() {
                toggleSidebar('dispatcherSidebar', 'dispatcherSidebarOverlay');
            });

            // Navigation items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.dataset.page;
                    navigateToPage(page);
                    
                    // Update active state in sidebar
                    const sidebar = this.closest('.sidebar');
                    if (sidebar) {
                        sidebar.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                        this.classList.add('active');
                    }
                    
                    // Close sidebar on mobile
                    if (window.innerWidth < 1024) {
                        const sidebarId = sidebar.id;
                        const overlayId = sidebarId === 'sidebar' ? 'sidebarOverlay' : 'dispatcherSidebarOverlay';
                        toggleSidebar(sidebarId, overlayId);
                    }
                });
            });

            // Bottom navigation
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const onclickAttr = this.getAttribute('onclick');
                    if (onclickAttr) {
                        const page = onclickAttr.match(/'([^']+)'/)[1];
                        navigateToPage(page);
                        
                        // Update active state
                        const bottomNav = this.closest('.bottom-nav');
                        if (bottomNav) {
                            bottomNav.querySelectorAll('.bottom-nav-item').forEach(nav => nav.classList.remove('active'));
                            this.classList.add('active');
                        }
                    }
                });
            });

            // Modal close handlers
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.classList.remove('active');
                    }
                });
            });

            // Close modals on overlay click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });

            // Package form submission
            document.getElementById('addPackageForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                addNewShipment();
            });

            // Driver form submission
            document.getElementById('addDriverForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                addNewDriver();
            });

            // Notifications button
            document.getElementById('notificationsBtn')?.addEventListener('click', showNotifications);

            // Add buttons
            document.getElementById('adminAddBtn')?.addEventListener('click', function() {
                showModal('addPackageModal');
            });

            document.getElementById('dispatcherAddBtn')?.addEventListener('click', function() {
                showModal('dispatcherAddPackageModal');
            });

            // Window resize handler
            window.addEventListener('resize', handleResize);
            
            // Initialize Firebase auth state listener
            if (window.firebase && window.firebase.onAuthStateChanged) {
                window.firebase.onAuthStateChanged(window.firebase.auth, (user) => {
                    if (user) {
                        console.log('User authenticated:', user.email);
                    }
                });
            }
        }

        function handleAuth() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            // Try Firebase authentication first
            if (window.firebase && window.firebase.signInWithEmailAndPassword) {
                window.firebase.signInWithEmailAndPassword(window.firebase.auth, email, password)
                    .then((userCredential) => {
                        // Firebase authentication successful
                        const user = userCredential.user;
                        determineUserRole(user.email);
                    })
                    .catch((error) => {
                        // Fallback to demo accounts if Firebase fails
                        useDemoAccounts(email, password);
                    });
            } else {
                // Use demo accounts if Firebase is not available
                useDemoAccounts(email, password);
            }
        }
        
        function determineUserRole(email) {
            // Determine role based on email pattern
            let role = 'driver';
            let name = 'User';
            
            if (email.includes('admin')) {
                role = 'admin';
                name = 'Administrator';
            } else if (email.includes('dispatch')) {
                role = 'dispatcher';
                name = 'Dispatch Manager';
            } else if (email.includes('driver')) {
                role = 'driver';
                name = 'Delivery Driver';
            }
            
            currentUser = { email, role, name, displayName: name.split(' ')[0] };
            currentRole = role;
            
            // Store session
            localStorage.setItem('cargolens_session', JSON.stringify({
                email: email,
                role: currentRole,
                name: currentUser.name,
                timestamp: Date.now()
            }));
            
            showToast('Login successful! Welcome to CargoLens', 'success');
            showDashboard();
            initializeDashboard();
        }
        
        function useDemoAccounts(email, password) {
            const accounts = {
                'admin@cargolens.co.zm': { 
                    password: 'admin123', 
                    role: 'admin', 
                    name: 'System Administrator',
                    displayName: 'Admin User'
                },
                'dispatch@cargolens.co.zm': { 
                    password: 'dispatch123', 
                    role: 'dispatcher', 
                    name: 'Dispatch Manager',
                    displayName: 'Dispatch Control'
                },
                'driver@cargolens.co.zm': { 
                    password: 'driver123', 
                    role: 'driver', 
                    name: 'Mike Johnson',
                    displayName: 'Driver'
                }
            };
            
            if (accounts[email] && accounts[email].password === password) {
                currentUser = accounts[email];
                currentRole = currentUser.role;
                
                // Store session
                localStorage.setItem('cargolens_session', JSON.stringify({
                    email: email,
                    role: currentRole,
                    name: currentUser.name,
                    timestamp: Date.now()
                }));
                
                showToast('Login successful! Welcome to CargoLens', 'success');
                showDashboard();
                initializeDashboard();
            } else {
                showToast('Invalid email or password', 'error');
            }
        }

        function checkAuthState() {
            const session = localStorage.getItem('cargolens_session');
            if (session) {
                try {
                    const data = JSON.parse(session);
                    // Check if session is less than 24 hours old
                    if (Date.now() - data.timestamp < 24 * 60 * 60 * 1000) {
                        currentUser = {
                            name: data.name,
                            role: data.role,
                            displayName: data.name.split(' ')[0]
                        };
                        currentRole = data.role;
                        showDashboard();
                        initializeDashboard();
                        return;
                    }
                } catch (e) {
                    console.log('Session expired or invalid');
                }
            }
            // Show auth page if no valid session
            document.getElementById('authPage').classList.remove('hidden');
        }

        function showDashboard() {
            // Hide auth page
            document.getElementById('authPage').classList.add('hidden');
            
            // Hide all dashboards
            document.querySelectorAll('.dashboard-container').forEach(d => {
                d.classList.remove('active');
            });
            
            // Show appropriate dashboard
            if (currentRole === 'admin') {
                document.getElementById('adminDashboard').classList.add('active');
                document.getElementById('mainFooter').style.display = 'block';
            } else if (currentRole === 'dispatcher') {
                document.getElementById('dispatcherDashboard').classList.add('active');
                document.getElementById('mainFooter').style.display = 'block';
            } else if (currentRole === 'driver') {
                document.getElementById('driverDashboard').classList.add('active');
                document.getElementById('mainFooter').style.display = 'block';
            }
            
            // Initialize responsive features
            handleResize();
        }

        function initializeDashboard() {
            updateUserInfo();
            
            if (currentRole === 'admin') {
                initializeAdminDashboard();
            } else if (currentRole === 'dispatcher') {
                initializeDispatcherDashboard();
            } else if (currentRole === 'driver') {
                initializeDriverDashboard();
            }
        }

        function updateUserInfo() {
            if (!currentUser) return;
            
            // Update avatars and names based on role
            if (currentRole === 'admin') {
                document.querySelectorAll('#adminDashboard .user-avatar').forEach(avatar => {
                    avatar.textContent = currentUser.displayName.charAt(0).toUpperCase();
                });
                document.querySelectorAll('#adminDashboard .user-name').forEach(name => {
                    name.textContent = currentUser.name;
                });
            } else if (currentRole === 'dispatcher') {
                document.querySelectorAll('#dispatcherDashboard .user-avatar').forEach(avatar => {
                    avatar.textContent = currentUser.displayName.charAt(0).toUpperCase();
                });
                document.querySelectorAll('#dispatcherDashboard .user-name').forEach(name => {
                    name.textContent = currentUser.name;
                });
            }
        }

        function initializeAdminDashboard() {
            // Populate data
            populateRecentShipments();
            populateAllShipments();
            populateDriversTable();
            populateTopDrivers();
            
            // Initialize charts
            initializeCharts();
            
            // Initialize maps
            initializeAdminMap();
            initializeTrackingMap();
            
            // Set initial page
            navigateToPage('admin-overview');
        }

        function initializeDispatcherDashboard() {
            // Populate dispatcher data
            populateDispatcherShipments();
            populateDispatcherDrivers();
            populatePendingAssignments();
            populateDriverAvailability();
            
            // Initialize dispatcher map
            initializeDispatcherMap();
            
            // Set initial page
            navigateToPage('dispatcher-overview');
        }

        function initializeDriverDashboard() {
            // Populate driver data
            populateDriverDeliveries();
            populateDriverActivity();
            
            // Initialize driver map
            initializeDriverMap();
            
            // Update status select
            updateDriverStatusSelect();
        }

        function toggleSidebar(sidebarId, overlayId) {
            const sidebar = document.getElementById(sidebarId);
            const overlay = document.getElementById(overlayId);
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            }
        }

        function navigateToPage(page) {
            currentPage = page;
            
            // Hide all pages in the current dashboard
            const activeDashboard = document.querySelector('.dashboard-container.active');
            if (activeDashboard) {
                activeDashboard.querySelectorAll('.page-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Show target page
                const targetPage = activeDashboard.querySelector('#' + page);
                if (targetPage) {
                    targetPage.classList.add('active');
                }
            }
            
            // Update page title
            updatePageTitle(page);
            
            // Initialize page-specific features
            switch(page) {
                case 'admin-tracking':
                    refreshTrackingMap();
                    break;
                case 'admin-analytics':
                    refreshAnalytics();
                    break;
                case 'dispatcher-tracking':
                    initializeDispatcherTrackingMap();
                    break;
            }
        }

        function updatePageTitle(page) {
            const titles = {
                'admin-overview': 'Dashboard Overview',
                'admin-analytics': 'Business Analytics',
                'admin-packages': 'Shipment Management',
                'admin-drivers': 'Driver Management',
                'admin-tracking': 'Live Tracking',
                'admin-routes': 'Route Planning',
                'admin-reports': 'Reports',
                'admin-settings': 'Settings',
                'admin-users': 'User Management',
                'dispatcher-overview': 'Dispatch Overview',
                'dispatcher-packages': 'Shipment Management',
                'dispatcher-drivers': 'Driver Management',
                'dispatcher-assignments': 'Assignments',
                'dispatcher-tracking': 'Live Tracking'
            };
            
            let titleElement;
            if (currentRole === 'admin') {
                titleElement = document.getElementById('pageTitle');
            } else if (currentRole === 'dispatcher') {
                titleElement = document.getElementById('dispatcherPageTitle');
            }
            
            if (titleElement && titles[page]) {
                titleElement.textContent = titles[page];
            }
        }

        function performSearch(query) {
            if (!query.trim()) {
                hideSearchResults();
                return;
            }
            
            const results = [];
            const searchLower = query.toLowerCase();
            
            // Search shipments
            sampleData.shipments.forEach(shipment => {
                if (shipment.id.toLowerCase().includes(searchLower) || 
                    shipment.recipient.toLowerCase().includes(searchLower) ||
                    shipment.city.toLowerCase().includes(searchLower)) {
                    results.push({
                        type: 'shipment',
                        id: shipment.id,
                        title: `Shipment: ${shipment.id}`,
                        subtitle: `${shipment.recipient}  ${shipment.city}`,
                        status: shipment.status
                    });
                }
            });
            
            // Search drivers
            sampleData.drivers.forEach(driver => {
                if (driver.name.toLowerCase().includes(searchLower) ||
                    driver.vehicle.toLowerCase().includes(searchLower) ||
                    driver.city.toLowerCase().includes(searchLower)) {
                    results.push({
                        type: 'driver',
                        id: driver.id,
                        title: `Driver: ${driver.name}`,
                        subtitle: `${driver.vehicle} | ${driver.city}`,
                        status: driver.status
                    });
                }
            });
            
            displaySearchResults(results);
        }

        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            if (!container) return;
            
            if (results.length === 0) {
                container.innerHTML = '<div class="search-result-item">No results found</div>';
            } else {
                container.innerHTML = results.slice(0, 8).map(result => `
                    <div class="search-result-item" onclick="handleSearchResult('${result.id}', '${result.type}')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 4px;">${result.title}</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">${result.subtitle}</div>
                            </div>
                            <span class="status-badge status-${result.status}">${result.status}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            container.classList.add('active');
        }

        function hideSearchResults() {
            const container = document.getElementById('searchResults');
            if (container) {
                container.classList.remove('active');
            }
        }

        function handleSearchResult(id, type) {
            showToast(`Selected ${type}: ${id}`, 'success');
            hideSearchResults();
            
            // Navigate based on type
            if (type === 'shipment') {
                navigateToPage('admin-packages');
            } else if (type === 'driver') {
                navigateToPage('admin-drivers');
            }
        }

        // Admin Dashboard Functions
        function populateRecentShipments() {
            const container = document.getElementById('recentShipments');
            if (!container) return;
            
            container.innerHTML = sampleData.shipments.slice(0, 5).map(shipment => `
                <tr>
                    <td><strong>${shipment.id}</strong></td>
                    <td>${shipment.city}</td>
                    <td><span class="status-badge status-${shipment.status}">${shipment.status.replace('-', ' ').toUpperCase()}</span></td>
                    <td>${shipment.driver || 'Unassigned'}</td>
                    <td>${shipment.eta}</td>
                </tr>
            `).join('');
        }

        function populateAllShipments() {
            const container = document.getElementById('allShipmentsTable');
            if (!container) return;
            
            container.innerHTML = sampleData.shipments.map(shipment => `
                <tr>
                    <td><strong>${shipment.id}</strong></td>
                    <td>
                        <div>${shipment.recipient}</div>
                        <div style="font-size: 0.85rem; color: var(--gray);">${shipment.weight}</div>
                    </td>
                    <td>${shipment.city}</td>
                    <td><span class="status-badge status-${shipment.status}">${shipment.status.replace('-', ' ').toUpperCase()}</span></td>
                    <td>${shipment.driver || 'Unassigned'}</td>
                    <td>${shipment.created}</td>
                    <td>
                        <button class="icon-btn" onclick="viewShipment('${shipment.id}')" style="background: transparent; color: var(--primary);">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="icon-btn" onclick="editShipment('${shipment.id}')" style="background: transparent; color: var(--warning); margin-left: 8px;">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function populateDriversTable() {
            const container = document.getElementById('driversTable');
            if (!container) return;
            
            container.innerHTML = sampleData.drivers.map(driver => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="user-avatar" style="width: 36px; height: 36px; font-size: 0.9rem;">${driver.name.charAt(0)}</div>
                            <div>
                                <div style="font-weight: 600;">${driver.name}</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">Rating: ${driver.rating}/5</div>
                            </div>
                        </div>
                    </td>
                    <td>${driver.phone}</td>
                    <td>${driver.vehicle}</td>
                    <td><span class="status-badge status-${driver.status}">${driver.status.toUpperCase()}</span></td>
                    <td>${driver.city}</td>
                    <td>${sampleData.shipments.filter(s => s.driver === driver.name).length}</td>
                    <td>
                        <button class="icon-btn" onclick="messageDriver('${driver.id}')" style="background: transparent; color: var(--primary);">
                            <i class="fas fa-comment"></i>
                        </button>
                        <button class="icon-btn" onclick="viewDriver('${driver.id}')" style="background: transparent; color: var(--success); margin-left: 8px;">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function populateTopDrivers() {
            const container = document.getElementById('topDriversTable');
            if (!container) return;
            
            container.innerHTML = sampleData.drivers.map(driver => `
                <tr>
                    <td>${driver.name}</td>
                    <td>${driver.deliveries}</td>
                    <td>${Math.round((driver.deliveries / (driver.deliveries + 20)) * 100)}%</td>
                    <td>${driver.rating}/5</td>
                    <td>${driver.city}</td>
                </tr>
            `).join('');
        }

        function initializeCharts() {
            // Performance Chart
            const perfCtx = document.getElementById('performanceChart');
            if (perfCtx) {
                new Chart(perfCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                        datasets: [{
                            label: 'Shipments',
                            data: [1200, 1350, 1400, 1280, 1450, 1600, 1750],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
            
            // Analytics Chart
            const analyticsCtx = document.getElementById('monthlyAnalyticsChart');
            if (analyticsCtx) {
                new Chart(analyticsCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Lusaka', 'Ndola', 'Kitwe', 'Livingstone', 'Kabwe'],
                        datasets: [{
                            label: 'Shipments',
                            data: [850, 620, 580, 320, 280],
                            backgroundColor: [
                                '#2563eb',
                                '#3b82f6',
                                '#60a5fa',
                                '#93c5fd',
                                '#bfdbfe'
                            ],
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
            
            // Regional Chart
            const regionalCtx = document.getElementById('regionalChart');
            if (regionalCtx) {
                new Chart(regionalCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Delivered', 'In Transit', 'Pending', 'Delayed'],
                        datasets: [{
                            data: [65, 20, 10, 5],
                            backgroundColor: [
                                '#10b981',
                                '#3b82f6',
                                '#f59e0b',
                                '#ef4444'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '75%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
            }
        }

        function initializeAdminMap() {
            const mapElement = document.getElementById('adminMap');
            if (!mapElement) return;
            
            // Focus on Zambia
            const map = L.map('adminMap').setView([-13.1333, 27.8500], 6);
            maps.admin = map;
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(map);
            
            // Add Zambian cities
            Object.values(zambiaCities).forEach(city => {
                L.marker([city.lat, city.lng]).addTo(map)
                    .bindPopup(`<b>${city.name}</b><br>Active shipments: ${Math.floor(Math.random() * 50) + 20}`)
                    .openPopup();
            });
            
            // Add driver markers
            sampleData.drivers.filter(d => d.status === 'active').forEach(driver => {
                const city = zambiaCities[driver.city.toLowerCase()];
                if (city) {
                    L.marker([city.lat, city.lng], {
                        icon: L.divIcon({
                            html: `<div style="background: #2563eb; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">
                                <i class="fas fa-truck"></i>
                            </div>`,
                            className: 'driver-marker',
                            iconSize: [36, 36]
                        })
                    }).addTo(map)
                    .bindPopup(`<b>${driver.name}</b><br>${driver.vehicle}<br>Status: ${driver.status}`);
                }
            });
        }

        function initializeTrackingMap() {
            const mapElement = document.getElementById('adminTrackingMap');
            if (!mapElement) return;
            
            // Focus on Zambia with more zoom
            const map = L.map('adminTrackingMap').setView([-13.1333, 27.8500], 7);
            maps.tracking = map;
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(map);
            
            // Add detailed city markers
            Object.values(zambiaCities).forEach(city => {
                L.circleMarker([city.lat, city.lng], {
                    radius: 8,
                    fillColor: '#2563eb',
                    color: '#1e40af',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map)
                .bindPopup(`<b>${city.name}</b><br>Distribution Center`);
            });
            
            // Simulate active shipments with moving markers
            simulateLiveTracking(map);
        }

        function simulateLiveTracking(map) {
            // Add some moving markers for simulation
            const routes = [
                { start: zambiaCities.lusaka, end: zambiaCities.ndola },
                { start: zambiaCities.kitwe, end: zambiaCities.lusaka },
                { start: zambiaCities.livingstone, end: zambiaCities.kabwe }
            ];
            
            routes.forEach((route, index) => {
                const marker = L.marker([route.start.lat, route.start.lng], {
                    icon: L.divIcon({
                        html: `<div style="background: ${index === 0 ? '#10b981' : index === 1 ? '#f59e0b' : '#ef4444'}; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                <i class="fas fa-shipping-fast"></i>
                            </div>`,
                        className: 'shipment-marker',
                        iconSize: [40, 40]
                    })
                }).addTo(map);
                
                marker.bindPopup(`<b>Shipment CL-2024-00${index + 1}</b><br>From: ${route.start.name}<br>To: ${route.end.name}<br>Status: In Transit<br>ETA: ${index + 2} hours`);
                
                // Animate movement
                let progress = 0;
                const animate = () => {
                    if (progress <= 1) {
                        const lat = route.start.lat + (route.end.lat - route.start.lat) * progress;
                        const lng = route.start.lng + (route.end.lng - route.start.lng) * progress;
                        marker.setLatLng([lat, lng]);
                        progress += 0.002;
                        setTimeout(animate, 100);
                    }
                };
                animate();
            });
        }

        // Dispatcher Dashboard Functions
        function populateDispatcherShipments() {
            const container = document.getElementById('dispatcherShipmentsTable');
            if (!container) return;
            
            container.innerHTML = sampleData.dispatcherShipments.map(shipment => `
                <tr>
                    <td><strong>${shipment.id}</strong></td>
                    <td>${shipment.recipient}</td>
                    <td>${shipment.city}</td>
                    <td><span class="status-badge status-${shipment.status}">${shipment.status.replace('-', ' ').toUpperCase()}</span></td>
                    <td>${shipment.driver || 'Unassigned'}</td>
                    <td><span class="status-badge ${shipment.priority === 'urgent' ? 'status-failed' : shipment.priority === 'express' ? 'status-pending' : 'status-in-transit'}">${shipment.priority.toUpperCase()}</span></td>
                    <td>
                        <button class="btn btn-sm" onclick="assignShipment('${shipment.id}')" ${shipment.status === 'assigned' ? 'disabled' : ''}>
                            ${shipment.status === 'assigned' ? 'Assigned' : 'Assign'}
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function populateDispatcherDrivers() {
            const container = document.getElementById('dispatcherDriversTable');
            if (!container) return;
            
            container.innerHTML = sampleData.drivers.map(driver => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="user-avatar" style="width: 36px; height: 36px; font-size: 0.9rem;">${driver.name.charAt(0)}</div>
                            <div>
                                <div style="font-weight: 600;">${driver.name}</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">${driver.city}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="status-badge status-${driver.currentStatus}">${driver.currentStatus.replace('-', ' ').toUpperCase()}</span></td>
                    <td>${driver.currentStatus === 'on-delivery' ? 'Delivering 2 packages' : 'Available for assignment'}</td>
                    <td>${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                    <td>
                        <button class="icon-btn" onclick="messageDispatcherDriver('${driver.id}')" style="background: transparent; color: var(--primary);">
                            <i class="fas fa-comment"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function populatePendingAssignments() {
            const container = document.getElementById('pendingAssignments');
            if (!container) return;
            
            const pending = sampleData.dispatcherShipments.filter(s => s.status === 'unassigned');
            
            if (pending.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            All shipments assigned!
                        </td>
                    </tr>
                `;
            } else {
                container.innerHTML = pending.map(shipment => `
                    <tr>
                        <td><strong>${shipment.id}</strong></td>
                        <td>${shipment.city}</td>
                        <td><span class="status-badge ${shipment.priority === 'urgent' ? 'status-failed' : shipment.priority === 'express' ? 'status-pending' : 'status-in-transit'}">${shipment.priority.toUpperCase()}</span></td>
                        <td>${shipment.created}</td>
                        <td>
                            <button class="btn btn-sm" onclick="quickAssign('${shipment.id}')">
                                Assign Now
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function populateDriverAvailability() {
            const container = document.getElementById('driverAvailability');
            if (!container) return;
            
            const availableDrivers = sampleData.drivers.filter(d => d.currentStatus === 'available' && d.status === 'active');
            
            if (availableDrivers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--gray);">
                        <i class="fas fa-users-slash" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                        No drivers available at the moment
                    </div>
                `;
            } else {
                container.innerHTML = availableDrivers.map(driver => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #f1f5f9;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="user-avatar" style="width: 32px; height: 32px; font-size: 0.8rem;">${driver.name.charAt(0)}</div>
                            <div>
                                <div style="font-weight: 600;">${driver.name}</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">${driver.city}  ${driver.vehicle}</div>
                            </div>
                        </div>
                        <span class="status-badge status-active">Available</span>
                    </div>
                `).join('');
            }
        }

        function initializeDispatcherMap() {
            const mapElement = document.getElementById('dispatcherMap');
            if (!mapElement) return;
            
            const map = L.map('dispatcherMap').setView([-13.1333, 27.8500], 6);
            maps.dispatcher = map;
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(map);
            
            // Add driver markers
            sampleData.drivers.filter(d => d.status === 'active').forEach(driver => {
                const city = zambiaCities[driver.city.toLowerCase()];
                if (city) {
                    const iconColor = driver.currentStatus === 'available' ? '#10b981' : 
                                     driver.currentStatus === 'on-delivery' ? '#f59e0b' : '#64748b';
                    
                    L.marker([city.lat, city.lng], {
                        icon: L.divIcon({
                            html: `<div style="background: ${iconColor}; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">
                                <i class="fas fa-truck"></i>
                            </div>`,
                            className: 'dispatcher-driver-marker',
                            iconSize: [40, 40]
                        })
                    }).addTo(map)
                    .bindPopup(`<b>${driver.name}</b><br>Status: ${driver.currentStatus}<br>Vehicle: ${driver.vehicle}`);
                }
            });
        }

        function initializeDispatcherTrackingMap() {
            const mapElement = document.getElementById('dispatcherTrackingMap');
            if (!mapElement) return;
            
            const map = L.map('dispatcherTrackingMap').setView([-13.1333, 27.8500], 7);
            maps.dispatcherTracking = map;
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(map);
            
            // Add shipment and driver markers
            sampleData.shipments.filter(s => s.status === 'in-transit').forEach((shipment, index) => {
                const city = zambiaCities[shipment.city.toLowerCase()];
                if (city) {
                    L.marker([city.lat + (Math.random() * 0.5 - 0.25), city.lng + (Math.random() * 0.5 - 0.25)], {
                        icon: L.divIcon({
                            html: `<div style="background: #2563eb; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                <i class="fas fa-box"></i>
                            </div>`,
                            className: 'tracking-marker',
                            iconSize: [40, 40]
                        })
                    }).addTo(map)
                    .bindPopup(`<b>${shipment.id}</b><br>To: ${shipment.recipient}<br>Driver: ${shipment.driver}<br>Status: In Transit`);
                }
            });
        }

        // Driver Dashboard Functions
        function populateDriverDeliveries() {
            const container = document.getElementById('driverDeliveries');
            if (!container) return;
            
            container.innerHTML = sampleData.driverDeliveries.map(delivery => `
                <div class="delivery-card">
                    <div class="delivery-header">
                        <div>
                            <h3 style="margin-bottom: 5px;">${delivery.recipient}</h3>
                            <p style="font-size: 0.9rem; color: var(--gray);">${delivery.address}</p>
                        </div>
                        <span class="status-badge status-${delivery.status}">${delivery.status.replace('-', ' ').toUpperCase()}</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div>
                            <div style="font-size: 0.85rem; color: var(--gray);">Tracking ID</div>
                            <div style="font-weight: 600;">${delivery.id}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.85rem; color: var(--gray);">ETA</div>
                            <div style="font-weight: 600;">${delivery.eta}</div>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${delivery.progress}%"></div>
                    </div>
                    
                    <div class="delivery-actions">
                        <button class="btn btn-sm" onclick="startDeliveryTask('${delivery.id}')" ${delivery.status === 'in-transit' ? 'disabled' : ''}>
                            ${delivery.status === 'in-transit' ? 'In Progress' : 'Start Delivery'}
                        </button>
                        <button class="btn btn-sm" onclick="scanDeliveryQR('${delivery.id}')">
                            <i class="fas fa-qrcode"></i> Scan
                        </button>
                        <button class="btn btn-sm" onclick="reportDeliveryIssue('${delivery.id}')">
                            <i class="fas fa-exclamation-triangle"></i> Issue
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function populateDriverActivity() {
            const container = document.getElementById('driverActivity');
            if (!container) return;
            
            const activities = [
                { time: '10:30 AM', action: 'Started delivery CL-2024-001', icon: 'fa-play-circle', color: 'success' },
                { time: '09:15 AM', action: 'Checked in for duty', icon: 'fa-check-circle', color: 'primary' },
                { time: 'Yesterday, 4:30 PM', action: 'Completed delivery CL-2024-003', icon: 'fa-check-circle', color: 'success' },
                { time: 'Yesterday, 2:15 PM', action: 'Reported traffic delay', icon: 'fa-exclamation-triangle', color: 'warning' }
            ];
            
            container.innerHTML = activities.map(activity => `
                <div style="display: flex; align-items: flex-start; gap: 15px; padding: 15px 0; border-bottom: 1px solid #f1f5f9;">
                    <div style="background: var(--${activity.color}-light); color: var(--${activity.color}); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class="fas ${activity.icon}"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 4px;">${activity.action}</div>
                        <div style="font-size: 0.85rem; color: var(--gray);">${activity.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function initializeDriverMap() {
            const mapElement = document.getElementById('driverMap');
            if (!mapElement) return;
            
            // Use Lusaka as default location for driver
            const map = L.map('driverMap').setView([zambiaCities.lusaka.lat, zambiaCities.lusaka.lng], 12);
            maps.driver = map;
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(map);
            
            // Add current location marker
            L.marker([zambiaCities.lusaka.lat, zambiaCities.lusaka.lng], {
                icon: L.divIcon({
                    html: `<div style="background: #2563eb; color: white; width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                        <i class="fas fa-truck"></i>
                    </div>`,
                    className: 'current-location-marker',
                    iconSize: [48, 48]
                })
            }).addTo(map)
            .bindPopup('<b>Your Current Location</b><br>Lusaka, Zambia')
            .openPopup();
            
            // Add destination markers for today's deliveries
            sampleData.driverDeliveries.forEach(delivery => {
                const city = delivery.address.includes('Lusaka') ? zambiaCities.lusaka : 
                           delivery.address.includes('Livingstone') ? zambiaCities.livingstone : zambiaCities.kasama;
                
                if (city) {
                    L.marker([city.lat, city.lng], {
                        icon: L.icon({
                            iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',
                            iconSize: [25, 41],
                            iconAnchor: [12, 41]
                        })
                    }).addTo(map)
                    .bindPopup(`<b>Delivery: ${delivery.id}</b><br>To: ${delivery.recipient}<br>Address: ${delivery.address}`);
                }
            });
        }

        function updateDriverStatusSelect() {
            const select = document.getElementById('driverStatusSelect');
            if (!select) return;
            
            // Set initial value based on driver's current status
            const driver = sampleData.drivers.find(d => d.name === currentUser?.name);
            if (driver && driver.currentStatus) {
                select.value = driver.currentStatus;
            }
        }

        // Utility Functions
        function refreshTrackingMap() {
            if (maps.tracking) {
                maps.tracking.invalidateSize();
            }
        }

        function refreshAnalytics() {
            showToast('Analytics refreshed', 'success');
        }

        function searchShipments(query) {
            console.log('Searching shipments:', query);
            // Implement search logic
        }

        function filterShipments(status) {
            console.log('Filtering shipments by:', status);
            // Implement filter logic
        }

        function searchDispatcherShipments(query) {
            console.log('Searching dispatcher shipments:', query);
            // Implement search logic
        }

        function filterDispatcherShipments(status) {
            console.log('Filtering dispatcher shipments by:', status);
            // Implement filter logic
        }

        function zoomToLusaka() {
            if (maps.tracking) {
                maps.tracking.setView([zambiaCities.lusaka.lat, zambiaCities.lusaka.lng], 12);
                showToast(`Zoomed to ${zambiaCities.lusaka.name}`, 'success');
            }
        }

        function zoomToNdola() {
            if (maps.tracking) {
                maps.tracking.setView([zambiaCities.ndola.lat, zambiaCities.ndola.lng], 12);
                showToast(`Zoomed to ${zambiaCities.ndola.name}`, 'success');
            }
        }

        function zoomToKitwe() {
            if (maps.tracking) {
                maps.tracking.setView([zambiaCities.kitwe.lat, zambiaCities.kitwe.lng], 12);
                showToast(`Zoomed to ${zambiaCities.kitwe.name}`, 'success');
            }
        }

        function dispatcherZoomToLusaka() {
            if (maps.dispatcherTracking) {
                maps.dispatcherTracking.setView([zambiaCities.lusaka.lat, zambiaCities.lusaka.lng], 12);
                showToast(`Zoomed to ${zambiaCities.lusaka.name}`, 'success');
            }
        }

        function showAllDrivers() {
            if (maps.dispatcherTracking) {
                maps.dispatcherTracking.setView([-13.1333, 27.8500], 7);
                showToast('Showing all drivers', 'success');
            }
        }

        function trackShipment() {
            const trackingId = document.getElementById('trackShipmentInput').value;
            if (trackingId) {
                showToast(`Tracking shipment: ${trackingId}`, 'success');
            } else {
                showToast('Please enter a tracking ID', 'warning');
            }
        }

        function focusOnDriver(driverId) {
            if (driverId && maps.tracking) {
                const driver = sampleData.drivers.find(d => d.id === driverId);
                if (driver) {
                    const city = zambiaCities[driver.city.toLowerCase()];
                    if (city) {
                        maps.tracking.setView([city.lat, city.lng], 13);
                        showToast(`Focused on ${driver.name} in ${driver.city}`, 'success');
                    }
                }
            }
        }

        function addNewShipment() {
            // Generate random shipment ID
            const shipmentId = 'CL-' + new Date().getFullYear() + '-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
            
            showToast(`New shipment created: ${shipmentId}`, 'success');
            hideModal('addPackageModal');
            
            // Refresh data
            populateRecentShipments();
            populateAllShipments();
        }

        function addNewDriver() {
            showToast('New driver added successfully', 'success');
            hideModal('addDriverModal');
            
            // Refresh data
            populateDriversTable();
        }

        function viewShipment(shipmentId) {
            showToast(`Viewing shipment: ${shipmentId}`, 'success');
        }

        function editShipment(shipmentId) {
            showToast(`Editing shipment: ${shipmentId}`, 'success');
        }

        function messageDriver(driverId) {
            showToast(`Messaging driver...`, 'success');
        }

        function viewDriver(driverId) {
            showToast(`Viewing driver details...`, 'success');
        }

        function assignShipment(shipmentId) {
            showToast(`Assigning shipment ${shipmentId}...`, 'success');
        }

        function quickAssign(shipmentId) {
            showToast(`Quick assigning shipment ${shipmentId}...`, 'success');
        }

        function messageDispatcherDriver(driverId) {
            showToast(`Messaging driver...`, 'success');
        }

        function refreshDriverStatus() {
            showToast('Driver status refreshed', 'success');
        }

        function createAssignment() {
            showToast('Assignment created successfully', 'success');
        }

        function startDeliveryTask(deliveryId) {
            showToast(`Starting delivery: ${deliveryId}`, 'success');
        }

        function scanDeliveryQR(deliveryId) {
            showToast(`Scanning QR for: ${deliveryId}`, 'success');
        }

        function reportDeliveryIssue(deliveryId) {
            showToast(`Reporting issue for: ${deliveryId}`, 'warning');
        }

        function updateDriverStatus(status) {
            showToast(`Status updated to: ${status.replace('-', ' ')}`, 'success');
        }

        function scanQRCode() {
            showToast('QR Scanner activated', 'success');
        }

        function startDelivery() {
            showToast('Delivery started', 'success');
        }

        function reportIssue() {
            showModal('issueModal');
        }

        function viewSchedule() {
            showToast('Opening schedule', 'success');
        }

        function showNotifications() {
            showToast('Notifications loaded', 'success');
        }

        function showModal(modalId) {
            document.getElementById(modalId)?.classList.add('active');
        }

        function hideModal(modalId) {
            document.getElementById(modalId)?.classList.remove('active');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            if (!toast) return;
            
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            toast.style.display = 'flex';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 4000);
        }

        function logout() {
            // Firebase logout if available
            if (window.firebase && window.firebase.signOut) {
                window.firebase.signOut(window.firebase.auth)
                    .then(() => {
                        console.log('User signed out from Firebase');
                    })
                    .catch((error) => {
                        console.error('Firebase sign out error:', error);
                    });
            }
            
            // Clear session
            localStorage.removeItem('cargolens_session');
            currentUser = null;
            currentRole = null;
            
            // Hide all dashboards
            document.querySelectorAll('.dashboard-container').forEach(d => {
                d.classList.remove('active');
            });
            
            // Hide footer
            document.getElementById('mainFooter').style.display = 'none';
            
            // Show auth page
            document.getElementById('authPage').classList.remove('hidden');
            
            showToast('Logged out successfully', 'success');
        }

        function handleResize() {
            // Handle responsive behaviors
            const searchBar = document.getElementById('searchBar');
            if (window.innerWidth >= 768 && searchBar) {
                searchBar.classList.remove('active');
            }
            
            // Close sidebar on desktop
            if (window.innerWidth >= 1024) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                if (sidebar) sidebar.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
                
                const dispatcherSidebar = document.getElementById('dispatcherSidebar');
                const dispatcherOverlay = document.getElementById('dispatcherSidebarOverlay');
                if (dispatcherSidebar) dispatcherSidebar.classList.remove('active');
                if (dispatcherOverlay) dispatcherOverlay.classList.remove('active');
            }
        }

        // Make functions globally available
        window.navigateToPage = navigateToPage;
        window.showModal = showModal;
        window.hideModal = hideModal;
        window.showToast = showToast;
        window.zoomToLusaka = zoomToLusaka;
        window.zoomToNdola = zoomToNdola;
        window.zoomToKitwe = zoomToKitwe;
        window.trackShipment = trackShipment;
        window.focusOnDriver = focusOnDriver;
        window.addNewShipment = addNewShipment;
        window.viewShipment = viewShipment;
        window.editShipment = editShipment;
        window.messageDriver = messageDriver;
        window.viewDriver = viewDriver;
        window.refreshMetrics = refreshAnalytics;
        window.exportToExcel = function() {
            showToast('Data exported to Excel', 'success');
        };
        window.exportDriverData = function() {
            showToast('Driver data exported', 'success');
        };
        window.refreshDriverMap = function() {
            if (maps.admin) {
                maps.admin.invalidateSize();
                showToast('Driver map refreshed', 'success');
            }
        };
        window.logout = logout;
        window.scanQRCode = scanQRCode;
        window.startDelivery = startDelivery;
        window.reportIssue = reportIssue;
        window.viewSchedule = viewSchedule;
        window.optimizeRoutes = function() {
            showToast('Routes optimized successfully', 'success');
        };
        window.createNewRoute = function() {
            showModal('newRouteModal');
        };
        window.generateReport = function(type) {
            showToast(`${type} report generated`, 'success');
        };
        window.saveSettings = function() {
            showToast('Settings saved successfully', 'success');
        };
        window.assignShipment = assignShipment;
        window.quickAssign = quickAssign;
        window.messageDispatcherDriver = messageDispatcherDriver;
        window.refreshDispatcherMap = function() {
            if (maps.dispatcher) {
                maps.dispatcher.invalidateSize();
                showToast('Dispatcher map refreshed', 'success');
            }
        };
        window.dispatcherZoomToLusaka = dispatcherZoomToLusaka;
        window.showAllDrivers = showAllDrivers;
        window.refreshDriverStatus = refreshDriverStatus;
        window.createAssignment = createAssignment;
        window.startDeliveryTask = startDeliveryTask;
        window.scanDeliveryQR = scanDeliveryQR;
        window.reportDeliveryIssue = reportDeliveryIssue;
        window.updateDriverStatus = updateDriverStatus;
    </script>
</body>
</html>